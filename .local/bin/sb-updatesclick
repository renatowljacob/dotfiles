#!/bin/sh

# 1 = left click

case $BLOCK_BUTTON in
	1)
		cachefile=${XDG_RUNTIME_DIR:-/tmp}/"dusk-updatesclick"
		updates="$(checkupdates -c --nocolor)"

		if [ -n "${updates}" ] || [ ! -e "${cachefile}" ]; then
			{ printf '%s' "${updates:-$(checkupdates --nocolor)}"; paru -Qu; } \
			| sed 's/\([[:alnum:]]*\) .*/\1/' > "${cachefile}"
		fi

		dunstify -a "Updates" "$(cat "${cachefile}")" \
		&& duskc --ignore-reply run_command setstatus 4 "$(sb-updates)" &
		;;
esac
